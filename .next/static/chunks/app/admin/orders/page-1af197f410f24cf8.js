(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4798],{968:(e,s,t)=>{Promise.resolve().then(t.bind(t,6402))},6402:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var a=t(5155),l=t(2115),i=t(2619),r=t.n(i);let n=["PENDING","PAID","FULFILLED","SHIPPED","REFUNDED"],d=["PENDING","PACKED","SHIPPED","DELIVERED","RETURNED"],c=["PENDING","SUCCEEDED","FAILED"],o=(e,s)=>new Intl.NumberFormat("en-US",{style:"currency",currency:s,maximumFractionDigits:2}).format(e/100);function x(){let[e,s]=(0,l.useState)([]),[t,i]=(0,l.useState)(null),[x,p]=(0,l.useState)(!0),[h,m]=(0,l.useState)(null),[u,j]=(0,l.useState)("all"),[g,N]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[v,y]=(0,l.useState)(""),[w,S]=(0,l.useState)(""),[k,C]=(0,l.useState)(""),[A,E]=(0,l.useState)(""),[D,P]=(0,l.useState)(""),O=async()=>{p(!0);let e="all"===u?"/api/admin/orders":"/api/admin/orders?status=".concat(u),t=await fetch(e,{credentials:"include"});if(!t.ok){m("Failed to load orders."),p(!1);return}s((await t.json()).data||[]),p(!1)};(0,l.useEffect)(()=>{O()},[u]);let I=(0,l.useMemo)(()=>e.find(e=>e.id===t)||null,[e,t]);(0,l.useEffect)(()=>{var e,s,t,a,l,i;if(!I){N(""),f(""),y(""),S(""),C(""),E(""),P("");return}N(I.status),f((null==(s=I.shipments)||null==(e=s[0])?void 0:e.trackingNumber)||""),y((null==(a=I.shipments)||null==(t=a[0])?void 0:t.status)||""),P((null==(i=I.payments)||null==(l=i[0])?void 0:l.id)||"")},[I]);let R=async()=>{if(!I)return;m(null);let e=await fetch("/api/admin/orders/".concat(I.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:g,trackingNumber:b||void 0,shipmentStatus:v||void 0}),credentials:"include"});if(!e.ok){let s=await e.json().catch(()=>null);m((null==s?void 0:s.error)||"Update failed.");return}await O()},T=async()=>{if(!I||!w.trim())return;m(null);let e=await fetch("/api/admin/orders/".concat(I.id,"/notes"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:w.trim()}),credentials:"include"});if(!e.ok){let s=await e.json().catch(()=>null);m((null==s?void 0:s.error)||"Note failed.");return}S(""),await O()},F=async()=>{if(!I)return;let e=Number(k);if(!Number.isFinite(e)||e<=0)return void m("Refund amount is required.");let s=await fetch("/api/admin/orders/".concat(I.id,"/refunds"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e,reason:A||void 0,paymentId:D||void 0}),credentials:"include"});if(!s.ok){let e=await s.json().catch(()=>null);m((null==e?void 0:e.error)||"Refund failed.");return}C(""),E(""),await O()},L=async(e,s)=>{let t=await fetch("/api/admin/refunds/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s}),credentials:"include"});if(!t.ok){let e=await t.json().catch(()=>null);m((null==e?void 0:e.error)||"Refund update failed.");return}await O()},M=I?I.payments.flatMap(e=>e.refunds||[]):[];return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-bebas text-5xl",children:"Orders"}),(0,a.jsx)("p",{className:"text-slate-400",children:"Track purchases, payments, and fulfillment."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("select",{value:u,onChange:e=>j(e.target.value),className:"bg-slate-900 border border-white/10 px-4 py-3 text-white",children:[(0,a.jsx)("option",{value:"all",children:"All statuses"}),n.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)(r(),{href:"/admin",className:"text-sm uppercase tracking-[0.2em] text-slate-400 hover:text-gold",children:"Back to Admin"})]})]}),h&&(0,a.jsx)("p",{className:"text-sm text-red-400",children:h}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1.2fr_1fr]",children:[(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"font-bebas text-2xl",children:"Recent Orders"}),x?(0,a.jsx)("p",{className:"text-slate-400",children:"Loading orders..."}):0===e.length?(0,a.jsx)("p",{className:"text-slate-400",children:"No orders yet."}):(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>{var s,l;return(0,a.jsxs)("button",{type:"button",onClick:()=>i(e.id),className:"w-full text-left border border-white/10 p-4 transition ".concat(t===e.id?"border-gold bg-slate-900/80":"bg-slate-900/40"),children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-bebas text-xl",children:["#",e.orderNumber]}),(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:e.email})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-slate-300",children:e.status}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:new Date(e.createdAt).toLocaleString()})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs text-slate-400",children:[(0,a.jsxs)("span",{children:[null!=(l=null==(s=e.items)?void 0:s.length)?l:0," items"]}),(0,a.jsx)("span",{children:"â€¢"}),(0,a.jsx)("span",{children:o(e.totalMinor,e.currency)})]})]},e.id)})})]}),(0,a.jsxs)("section",{className:"border border-white/10 bg-slate-900/60 p-6",children:[(0,a.jsx)("h2",{className:"font-bebas text-2xl mb-4",children:"Order Details"}),I?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-bebas text-xl",children:["#",I.orderNumber]}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:I.email})]}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Status"}),(0,a.jsx)("select",{value:g,onChange:e=>N(e.target.value),className:"mt-2 w-full bg-slate-950 border border-white/10 px-4 py-3 text-white",children:n.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Shipment Status"}),(0,a.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"mt-2 w-full bg-slate-950 border border-white/10 px-4 py-3 text-white",children:[(0,a.jsx)("option",{value:"",children:"Not set"}),d.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Tracking Number"}),(0,a.jsx)("input",{value:b,onChange:e=>f(e.target.value),className:"mt-2 w-full bg-slate-950 border border-white/10 px-4 py-3 text-white focus:outline-none focus:border-gold"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Shipping Method"}),(0,a.jsx)("p",{className:"mt-3 text-sm text-slate-300",children:I.shippingMethod})]})]}),(0,a.jsx)("button",{onClick:R,className:"w-full bg-gold text-slate-950 font-barlow font-bold uppercase tracking-wider py-3 hover:bg-white transition-colors",children:"Save Updates"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bebas text-lg mb-2",children:"Items"}),(0,a.jsx)("div",{className:"space-y-2",children:I.items.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-slate-300",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:e.productName}),e.variantName&&(0,a.jsx)("p",{className:"text-xs text-slate-500",children:e.variantName})]}),(0,a.jsxs)("div",{children:[e.quantity," ? EUR ",e.unitPriceEur]})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bebas text-lg mb-2",children:"Payment"}),0===I.payments.length?(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"No payments recorded."}):(0,a.jsx)("div",{className:"space-y-2",children:I.payments.map(e=>(0,a.jsxs)("div",{className:"text-sm text-slate-300",children:[e.provider," \xb7 ",e.status," \xb7 ",o(e.amountMinor,e.currency)]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bebas text-lg mb-2",children:"Refunds"}),0===I.payments.length?(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"No payments available for refunds."}):(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,a.jsx)("input",{type:"number",placeholder:"Amount (".concat(I.currency,")"),value:k,onChange:e=>C(e.target.value),className:"w-full bg-slate-950 border border-white/10 px-4 py-3 text-white focus:outline-none focus:border-gold"}),(0,a.jsx)("input",{placeholder:"Reason (optional)",value:A,onChange:e=>E(e.target.value),className:"w-full bg-slate-950 border border-white/10 px-4 py-3 text-white focus:outline-none focus:border-gold"}),(0,a.jsx)("select",{value:D,onChange:e=>P(e.target.value),className:"w-full bg-slate-950 border border-white/10 px-4 py-3 text-white",children:I.payments.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.provider," ",o(e.amountMinor,e.currency)]},e.id))})]}),(0,a.jsx)("button",{onClick:F,className:"w-full bg-slate-800 text-white uppercase tracking-[0.2em] text-xs py-3 hover:bg-slate-700",children:"Create Refund"})]}),0===M.length?(0,a.jsx)("p",{className:"text-sm text-slate-400 mt-4",children:"No refunds yet."}):(0,a.jsx)("div",{className:"mt-4 space-y-3",children:M.map(e=>(0,a.jsxs)("div",{className:"border border-white/10 p-3 text-sm text-slate-300",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsxs)("span",{children:[o(e.amountMinor,I.currency)," \xb7 ",e.status]}),(0,a.jsx)("select",{value:e.status,onChange:s=>L(e.id,s.target.value),className:"bg-slate-950 border border-white/10 px-3 py-2 text-white",children:c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),e.reason&&(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:e.reason})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bebas text-lg mb-2",children:"Timeline"}),I.events&&I.events.length>0?(0,a.jsx)("div",{className:"space-y-3",children:I.events.map(e=>{var s;return(0,a.jsxs)("div",{className:"border border-white/10 p-3 text-sm text-slate-300",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:e.type}),(0,a.jsx)("p",{className:"mt-1",children:e.message}),(0,a.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:[new Date(e.createdAt).toLocaleString()," \xb7 ",(null==(s=e.createdBy)?void 0:s.email)||"system"]})]},e.id)})}):(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"No events yet."}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsx)("textarea",{value:w,onChange:e=>S(e.target.value),placeholder:"Add internal note",className:"w-full bg-slate-950 border border-white/10 px-4 py-3 text-white focus:outline-none focus:border-gold",rows:3}),(0,a.jsx)("button",{onClick:T,className:"w-full bg-slate-800 text-white uppercase tracking-[0.2em] text-xs py-3 hover:bg-slate-700",children:"Add Note"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-bebas text-lg mb-2",children:"Shipping Address"}),I.shippingAddress?(0,a.jsxs)("div",{className:"text-sm text-slate-300 space-y-1",children:[(0,a.jsx)("p",{children:I.shippingAddress.name}),(0,a.jsx)("p",{children:I.shippingAddress.street1}),I.shippingAddress.street2&&(0,a.jsx)("p",{children:I.shippingAddress.street2}),(0,a.jsxs)("p",{children:[I.shippingAddress.city,I.shippingAddress.region?", ".concat(I.shippingAddress.region):""]}),I.shippingAddress.postalCode&&(0,a.jsx)("p",{children:I.shippingAddress.postalCode}),(0,a.jsx)("p",{children:I.shippingAddress.country}),I.shippingAddress.novaPostOfficeName&&(0,a.jsxs)("p",{children:["Nova Post: ",I.shippingAddress.novaPostOfficeName]})]}):(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"No shipping address."})]})]}):(0,a.jsx)("p",{className:"text-slate-400",children:"Select an order to view details."})]})]})]})}}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=968)),_N_E=e.O()}]);